# Coding Lessons (React + Vite)

Minimal scaffold for a small web app to teach coding. This prototype:

- Uses React + Vite (TypeScript)
- Loads lessons from `public/lessons/manifest.json`
- Persists lesson completion progress via Supabase when configured (falls back to localStorage if not configured)

## Getting started

Prerequisites: Node.js 18+ (pnpm preferred, but npm works too).

Install deps:

- pnpm install
  or
- npm install

Run the dev server:

- pnpm dev
  or
- npm run dev

Then open the URL shown in the terminal (usually http://localhost:5173).

## Configure Supabase (for cloud persistence)

This app can save your completed lesson IDs in Supabase. If not configured, it will store progress locally in your browser.

1) Create a Supabase project at https://supabase.com and grab:
   - Project URL
   - anon public key

2) Create the table (SQL):

```sql
create table if not exists public.lesson_progress (
  user_id   text       not null,
  lesson_id text       not null,
  completed boolean    not null default true,
  inserted_at timestamptz not null default now(),
  primary key (user_id, lesson_id)
);
-- For a quick prototype, you may choose to disable RLS on this table.
-- For production, enable RLS and add proper policies for your auth model.
```

3) Environment variables (Vite expects VITE_ prefix). Create `.env.local` in the repo root:

```
VITE_SUPABASE_URL=your-project-url
VITE_SUPABASE_ANON_KEY=your-anon-public-key
```

Or copy `.env.example` to `.env.local` and fill in values.

With env vars set, restart the dev server. The footer will show whether progress is stored via Supabase or local storage.

## Lessons

Static lesson JSON files live under `public/lessons/`. The list of available lessons is in `public/lessons/manifest.json` and each lesson file looks like:

```json
{
  "title": "Welcome to Your First Lesson",
  "content": "Some lesson text goes here."
}
```

## Notes

- This is intentionally light-weight and framework-free beyond Vite + React.
- A tiny progress service at `src/lib/progress.ts` persists completion via Supabase when configured.
- IDE metadata under `.idea/` can be regenerated by JetBrains IDEs if needed.


---

## Account system (Supabase Auth)

This app now includes a minimal account system backed by Supabase Auth (email + password):

- If Supabase is configured, users can sign up, sign in, and sign out via dedicated pages (Sign In, Account) accessible from the header navigation.
- Lesson progress in the database is tied to the authenticated user id (auth.users.id).
- If Supabase is not configured, the app falls back to local storage and a local anonymous id.

How it works in code:
- Supabase client: src/lib/supabaseClient.ts (reads Vite env vars)
- Auth helpers: src/lib/auth.ts (signUp, signIn, signOut, onAuthChange)
- UI integration: src/App.tsx (header navigation + hash routes), pages under src/pages (SignIn.tsx, Account.tsx)
- Progress storage: src/lib/progress.ts (uses authenticated user id when available)

### Required environment variables

Copy .env.example to .env.local and fill in values:

```
VITE_SUPABASE_URL=your-project-url
VITE_SUPABASE_ANON_KEY=your-anon-public-key
```

Restart the dev server after configuring env vars.

## Supabase schema: tables to create

Create these tables in your Supabase project (plus policies). SQL is written for the public schema.

1) lesson_progress (per-user lesson completion)

```sql
create table if not exists public.lesson_progress (
  user_id     uuid        not null references auth.users(id) on delete cascade,
  lesson_id   text        not null,
  completed   boolean     not null default true,
  completed_at timestamptz not null default now(),
  primary key (user_id, lesson_id)
);

alter table public.lesson_progress enable row level security;

-- Policies: allow each user to manage only their own rows
create policy "lp_select_own" on public.lesson_progress
  for select using (auth.uid() = user_id);

create policy "lp_insert_own" on public.lesson_progress
  for insert with check (auth.uid() = user_id);

create policy "lp_update_own" on public.lesson_progress
  for update using (auth.uid() = user_id) with check (auth.uid() = user_id);

create policy "lp_delete_own" on public.lesson_progress
  for delete using (auth.uid() = user_id);

-- Optional helpful index
create index if not exists lesson_progress_user_completed_idx
  on public.lesson_progress(user_id, completed);
```

2) Optional: profiles (basic user profile data)

```sql
create table if not exists public.profiles (
  id         uuid primary key references auth.users(id) on delete cascade,
  username   text unique,
  full_name  text,
  avatar_url text,
  updated_at timestamptz not null default now()
);

alter table public.profiles enable row level security;

-- Users can read and update only their own profile
create policy "profiles_select_own" on public.profiles
  for select using (auth.uid() = id);

create policy "profiles_upsert_own" on public.profiles
  for insert with check (auth.uid() = id);

create policy "profiles_update_own" on public.profiles
  for update using (auth.uid() = id) with check (auth.uid() = id);
```

Notes:
- Supabase automatically creates and manages the auth.users table. You only create application tables in the public schema and reference auth.users(id).
- If you previously created the simple lesson_progress table with a text user_id, you can drop it and create the one above to tie records to real accounts.
- In the UI, use the Sign In page via the header navigation (or go directly to #/signin) to create an account and sign in.


## Styling and design system

This project uses a single reusable stylesheet at `src/styles.css` for all visuals. Avoid inline styles in JSX/HTML and prefer the provided classes and CSS variables.

- Theme variables (defined in `:root` and adapted for dark mode):
  - Colors: `--color-bg`, `--color-surface`, `--color-text`, `--color-muted`, `--color-border`, `--color-primary`, `--color-primary-strong`, `--color-primary-soft`, `--color-danger`, `--color-success`, `--color-warning`.
  - Spacing: `--space-1..6`
  - Radii: `--radius-sm`, `--radius-md`, `--radius-lg`
  - Shadows: `--shadow-sm`, `--shadow-md`
  - Typography sizes: `--fs-sm`, `--fs-base`, `--fs-lg`, `--fs-xl`

- Layout helpers:
  - `.container` centers content with a max width.
  - `.layout` builds the 240px sidebar + content grid.
  - `.sidebar` adds the right border and inner padding.
  - `.content` adds default page padding.
  - `.header-bar` is a responsive flex row with space-between and wrapping.

- Navigation list (sidebar):
  - `.nav-list` resets list styles; `.nav-item` spaces items; `.nav-button` makes each lesson a full-width button; add `.is-active` for the selected lesson.

- Components:
  - Buttons: `.btn` base + variants `.btn-primary`, `.btn-secondary`, `.btn-ghost`.
  - Inputs: `.input` for text/email/password fields.
  - Cards: `.lesson` styles the lesson article container.
  - Alerts/errors: `.error` and utility `.text-danger`.

- Utilities:
  - Spacing: `.mt-1`..`.mt-4`, `.mb-2`, `.mr-2`, `.ml-auto`
  - Text: `.text-muted`, `.text-danger`
  - Flex cluster: `.cluster` for inline forms/controls with consistent gaps

- Accessibility:
  - Keyboard focus uses `:focus-visible` outlines for `.btn`, `.input`, and `.nav-button`.

- Conventions and rules:
  - Do not use inline `style` props; add or reuse a class and update `src/styles.css` if needed.
  - Keep the color scheme unified by consuming CSS variables instead of hard-coded HEX values.
  - Avoid animations for now; the CSS is structured to allow adding transitions or motion later.

The stylesheet is imported once in `src/main.tsx` and applies globally.

# Coding Lessons (React + Vite)

Minimal scaffold for a small web app to teach coding. This prototype:

- Uses React + Vite (TypeScript)
- Loads lessons from `public/lessons/manifest.json`
- Persists lesson completion progress via Supabase when configured (falls back to localStorage if not configured)

## Getting started

Prerequisites: Node.js 18+ (pnpm preferred, but npm works too).

Install deps:

- pnpm install
  or
- npm install

Run the dev server:

- pnpm dev
  or
- npm run dev

Then open the URL shown in the terminal (usually http://localhost:5173).

## Configure Supabase (for cloud persistence)

This app can save your completed lesson IDs in Supabase. If not configured, it will store progress locally in your browser.

1) Create a Supabase project at https://supabase.com and grab:
   - Project URL
   - anon public key

2) Create the table (SQL):

```sql
create table if not exists public.lesson_progress (
  user_id   text       not null,
  lesson_id text       not null,
  completed boolean    not null default true,
  inserted_at timestamptz not null default now(),
  primary key (user_id, lesson_id)
);
-- For a quick prototype, you may choose to disable RLS on this table.
-- For production, enable RLS and add proper policies for your auth model.
```

3) Environment variables (Vite expects VITE_ prefix). Create `.env.local` in the repo root:

```
VITE_SUPABASE_URL=your-project-url
VITE_SUPABASE_ANON_KEY=your-anon-public-key
```

Or copy `.env.example` to `.env.local` and fill in values.

With env vars set, restart the dev server. The footer will show whether progress is stored via Supabase or local storage.

## Lessons

Static lesson JSON files live under `public/lessons/`. The list of available lessons is in `public/lessons/manifest.json` and each lesson file looks like:

```json
{
  "title": "Welcome to Your First Lesson",
  "content": "Some lesson text goes here."
}
```

## Notes

- This is intentionally light-weight and framework-free beyond Vite + React.
- A tiny progress service at `src/lib/progress.ts` persists completion via Supabase when configured.
- IDE metadata under `.idea/` can be regenerated by JetBrains IDEs if needed.


---

## Account system (Supabase Auth)

This app now includes a minimal account system backed by Supabase Auth (email + password):

- If Supabase is configured, users can sign up, sign in, and sign out via dedicated pages (Sign In, Account) accessible from the header navigation.
- Lesson progress in the database is tied to the authenticated user id (auth.users.id).
- If Supabase is not configured, the app falls back to local storage and a local anonymous id.

How it works in code:
- Supabase client: src/lib/supabaseClient.ts (reads Vite env vars)
- Auth helpers: src/lib/auth.ts (signUp, signIn, signOut, onAuthChange)
- UI integration: src/App.tsx (header navigation + hash routes), pages under src/pages (SignIn.tsx, Account.tsx)
- Progress storage: src/lib/progress.ts (uses authenticated user id when available)

### Required environment variables

Copy .env.example to .env.local and fill in values:

```
VITE_SUPABASE_URL=your-project-url
VITE_SUPABASE_ANON_KEY=your-anon-public-key
```

Restart the dev server after configuring env vars.

## Supabase schema: tables to create

Create these tables in your Supabase project (plus policies). SQL is written for the public schema.

1) lesson_progress (per-user lesson completion)

```sql
create table if not exists public.lesson_progress (
  user_id     uuid        not null references auth.users(id) on delete cascade,
  lesson_id   text        not null,
  completed   boolean     not null default true,
  completed_at timestamptz not null default now(),
  primary key (user_id, lesson_id)
);

alter table public.lesson_progress enable row level security;

-- Policies: allow each user to manage only their own rows
create policy "lp_select_own" on public.lesson_progress
  for select using (auth.uid() = user_id);

create policy "lp_insert_own" on public.lesson_progress
  for insert with check (auth.uid() = user_id);

create policy "lp_update_own" on public.lesson_progress
  for update using (auth.uid() = user_id) with check (auth.uid() = user_id);

create policy "lp_delete_own" on public.lesson_progress
  for delete using (auth.uid() = user_id);

-- Optional helpful index
create index if not exists lesson_progress_user_completed_idx
  on public.lesson_progress(user_id, completed);
```

2) Optional: profiles (basic user profile data)

```sql
create table if not exists public.profiles (
  id         uuid primary key references auth.users(id) on delete cascade,
  username   text unique,
  full_name  text,
  avatar_url text,
  updated_at timestamptz not null default now()
);

alter table public.profiles enable row level security;

-- Users can read and update only their own profile
create policy "profiles_select_own" on public.profiles
  for select using (auth.uid() = id);

create policy "profiles_upsert_own" on public.profiles
  for insert with check (auth.uid() = id);

create policy "profiles_update_own" on public.profiles
  for update using (auth.uid() = id) with check (auth.uid() = id);
```

Notes:
- Supabase automatically creates and manages the auth.users table. You only create application tables in the public schema and reference auth.users(id).
- If you previously created the simple lesson_progress table with a text user_id, you can drop it and create the one above to tie records to real accounts.
- In the UI, use the Sign In page via the header navigation (or go directly to #/signin) to create an account and sign in.


## Styling and design system

This project uses a single reusable stylesheet at `src/styles.css` for all visuals. Avoid inline styles in JSX/HTML and prefer the provided classes and CSS variables.

- Theme variables (defined in `:root` and adapted for dark mode):
  - Colors: `--color-bg`, `--color-surface`, `--color-text`, `--color-muted`, `--color-border`, `--color-primary`, `--color-primary-strong`, `--color-primary-soft`, `--color-danger`, `--color-success`, `--color-warning`.
  - Spacing: `--space-1..6`
  - Radii: `--radius-sm`, `--radius-md`, `--radius-lg`
  - Shadows: `--shadow-sm`, `--shadow-md`
  - Typography sizes: `--fs-sm`, `--fs-base`, `--fs-lg`, `--fs-xl`

- Layout helpers:
  - `.container` centers content with a max width.
  - `.layout` builds the 240px sidebar + content grid.
  - `.sidebar` adds the right border and inner padding.
  - `.content` adds default page padding.
  - `.header-bar` is a responsive flex row with space-between and wrapping.

- Navigation list (sidebar):
  - `.nav-list` resets list styles; `.nav-item` spaces items; `.nav-button` makes each lesson a full-width button; add `.is-active` for the selected lesson.

- Components:
  - Buttons: `.btn` base + variants `.btn-primary`, `.btn-secondary`, `.btn-ghost`.
  - Inputs: `.input` for text/email/password fields.
  - Cards: `.lesson` styles the lesson article container.
  - Alerts/errors: `.error` and utility `.text-danger`.

- Utilities:
  - Spacing: `.mt-1`..`.mt-4`, `.mb-2`, `.mr-2`, `.ml-auto`
  - Text: `.text-muted`, `.text-danger`
  - Flex cluster: `.cluster` for inline forms/controls with consistent gaps

- Accessibility:
  - Keyboard focus uses `:focus-visible` outlines for `.btn`, `.input`, and `.nav-button`.

- Conventions and rules:
  - Do not use inline `style` props; add or reuse a class and update `src/styles.css` if needed.
  - Keep the color scheme unified by consuming CSS variables instead of hard-coded HEX values.
  - Avoid animations for now; the CSS is structured to allow adding transitions or motion later.

The stylesheet is imported once in `src/main.tsx` and applies globally.

## UI/UX rules

- Do not use `window.confirm`. All messages, confirmations, and warnings must be implemented in-site using accessible UI components (e.g., modal dialogs, inline alerts). A simple `ConfirmDialog` component exists at `src/components/ConfirmDialog.tsx` for confirmation flows.
- Avoid inline styles except when strictly necessary for layout sizing/positioning. Prefer CSS classes in `src/styles.css` for visuals and theming.
- Do not add random/ambient informational text to the UI (e.g., "Signed in as [email]"). Information like the active account should only appear when it directly guides the user through tasks (e.g., sign-in/sign-up). Otherwise, put this debug info in the console.
- Absolutely no emojis in the UI. Use custom styles, vector graphics (SVG), raster images (prompt user beforehand for raster images), and colors for visual indicators.



## Enable C and C# execution (self-hosted adapters, Option A)

This app ships the UI and workers for C and C# execution, but not the heavy WebAssembly toolchains. To enable them, self-host adapters under `public/vendor/` so they are served statically by Vite/your host.

Quick steps:
1. Read `public/vendor/README-ADAPTERS.md` for the exact adapter contract and file layout.
2. Provide these entry files (and their assets):
   - `public/vendor/c/c-backend.js` (must define `self.C_BACKEND.compileAndRun`)
   - `public/vendor/csharp/csharp-backend.js` (must define `self.CSHARP_BACKEND.compileAndRun`)
3. Start dev server: `npm run dev`. Open a C or C# exercise and click Run.

Notes:
- Execution is fully client-side; workers disable network for user programs and the host enforces strict timeouts by terminating workers.
- If the adapters are missing, the workers still initialize and show a clear error message on Run with pointers to the setup docs.
