:root {
  color-scheme: light dark;
  /* Theme colors */
  --color-bg: #ffffff;
  --color-surface: #f7f8fa;
  --color-text: #111827;
  --color-muted: #6b7280;
  --color-border: #e5e7eb;
  --color-primary: #2563eb; /* blue-600 */
  --color-primary-strong: #1d4ed8; /* blue-700 */
  --color-primary-soft: #eff6ff; /* blue-50 */
  --color-danger: #dc2626;
  --color-success: #16a34a;
  --color-warning: #d97706;
  --color-inverse: #ffffff;

  /* Borders */
  --border-thickness: 2px;

  /* Radii */
  --radius-sm: 6px;
  --radius-md: 8px;
  --radius-lg: 12px;

  /* Spacing scale */
  --space-1: 4px;
  --space-2: 8px;
  --space-3: 12px;
  --space-4: 16px;
  --space-5: 24px;
  --space-6: 32px;

  /* Shadows */
  --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
  --shadow-md: 0 6px 16px rgba(0,0,0,0.08);

  /* Typography */
  --fs-sm: .875rem;
  --fs-base: 1rem;
  --fs-lg: 1.125rem;
  --fs-xl: 1.25rem;

  /* Editor selection (customizable) */
  --editor-selection-bg: rgba(37, 99, 235, 0.25);
  --editor-selection-text: inherit;
}

@media (prefers-color-scheme: dark) {
  :root {
    --color-bg: #0f172a; /* slate-900 */
    --color-surface: #111827; /* gray-900 */
    --color-text: #e5e7eb; /* gray-200 */
    --color-muted: #9ca3af; /* gray-400 */
    --color-border: #374151; /* gray-700 */
    --color-primary: #60a5fa; /* blue-400 */
    --color-primary-strong: #3b82f6; /* blue-500 */
    --color-primary-soft: rgba(96,165,250,0.15);
    --color-inverse: #0b1020;
  }
}

* { box-sizing: border-box; }

html, body, #root { height: 100%; }

body {
  margin: 0;
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
  line-height: 1.5;
  background: var(--color-bg);
  color: var(--color-text);
  padding: var(--space-5);
}

/* Global text selection: disable site-wide by default */
body, body * {
  -webkit-user-select: none;
  -ms-user-select: none;
  -moz-user-select: none;
  user-select: none;
}

/* Allow selection on Account page */
.account-page, .account-page * {
  -webkit-user-select: text;
  -ms-user-select: text;
  -moz-user-select: text;
  user-select: text;
}

/* Allow selection in code editor textarea */
.code-editor {
  -webkit-user-select: text;
  -ms-user-select: text;
  -moz-user-select: text;
  user-select: text;
}

img, svg, video { max-width: 100%; height: auto; }

a { color: var(--color-primary); text-decoration: none; }
a:hover { text-decoration: underline; }

/* Layout */
.container {
  max-width: 1000px;
  margin: 0 auto;
}

.layout { display: grid; grid-template-columns: 240px 1fr; gap: var(--space-4); }

.sidebar {
  border-right: var(--border-thickness) solid var(--color-border);
  padding-right: var(--space-3);
}

.content { padding: var(--space-4); }

.header-bar {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: var(--space-3);
  flex-wrap: wrap;
}

/* Navigation list */
.nav-list { list-style: none; margin: 0; padding: 0; }
.nav-item + .nav-item { margin-top: 6px; }
.nav-button {
  width: 100%;
  text-align: left;
  padding: var(--space-2) var(--space-3);
  border-radius: var(--radius-sm);
  border: var(--border-thickness) solid var(--color-border);
  background: transparent;
  color: inherit;
  cursor: pointer;
}
.nav-button:hover { background: var(--color-surface); }
.nav-button strong { font-weight: 600; }
.nav-button.is-active { background: var(--color-primary-soft); border-color: var(--color-primary); }
.nav-button.is-active strong { font-weight: 700; }

/* Components */
.input {
  padding: 6px 8px;
  border: var(--border-thickness) solid var(--color-border);
  border-radius: var(--radius-sm);
  background: var(--color-bg);
  color: var(--color-text);
}

.btn {
  padding: 6px 10px;
  border-radius: var(--radius-sm);
  border: var(--border-thickness) solid var(--color-border);
  cursor: pointer;
  background: var(--color-surface);
  color: inherit;
}
.btn:disabled { opacity: .6; cursor: not-allowed; }
.btn-primary { background: var(--color-primary); color: var(--color-inverse); border-color: var(--color-primary-strong); }
.btn-primary:hover { background: var(--color-primary-strong); }
.btn-secondary { background: var(--color-surface); }
.btn-ghost { background: transparent; }

.lesson {
  padding: var(--space-4);
  border: var(--border-thickness) solid var(--color-border);
  border-radius: var(--radius-md);
  background: var(--color-surface);
  box-shadow: var(--shadow-sm);
}

/* Text helpers */
.text-muted { color: var(--color-muted); }
.text-danger { color: var(--color-danger); }
.text-success { color: var(--color-success); }

.error { color: var(--color-danger); font-weight: 600; }

/* Utilities */
.mr-2 { margin-right: var(--space-2); }
.mt-1 { margin-top: var(--space-1); }
.mt-2 { margin-top: var(--space-2); }
.mt-3 { margin-top: var(--space-3); }
.mt-4 { margin-top: var(--space-4); }
.mb-2 { margin-bottom: var(--space-2); }
.ml-auto { margin-left: auto; }

.cluster { display: flex; gap: var(--space-2); align-items: center; flex-wrap: wrap; }

footer { color: var(--color-muted); }

/* Focus styles */
.btn:focus-visible, .input:focus-visible, .nav-button:focus-visible { outline: 2px solid var(--color-primary); outline-offset: 2px; }

/* Modal */
.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.4);
  display: grid;
  place-items: center;
  z-index: 1000;
}
.modal {
  width: min(92vw, 520px);
  background: var(--color-surface);
  color: var(--color-text);
  border: var(--border-thickness) solid var(--color-border);
  border-radius: var(--radius-md);
  box-shadow: var(--shadow-md);
}
.modal-header { padding: var(--space-4); border-bottom: var(--border-thickness) solid var(--color-border); }
.modal-body { padding: var(--space-4); }
.modal-actions { padding: var(--space-3) var(--space-4) var(--space-4); display: flex; gap: var(--space-2); justify-content: flex-end; }


/* Code Interpreter styles */
.interpreter {
  border: var(--border-thickness) solid var(--color-border);
  border-radius: 0;
  background: var(--color-surface);
  box-shadow: var(--shadow-sm);
}
.interpreter-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: var(--space-1) var(--space-2);
  border-bottom: var(--border-thickness) solid var(--color-border);
}
/* .interpreter-body removed: textarea rendered directly for a flatter structure */
.interpreter-footer { padding: var(--space-2); border-top: var(--border-thickness) solid var(--color-border); }
.interpreter-footer-row { display: grid; grid-template-columns: 1fr minmax(240px, 320px); gap: var(--space-3); align-items: stretch; }
.interpreter-side-panel { border: var(--border-thickness) solid var(--color-border); border-radius: var(--radius-sm); background: var(--color-bg); padding: var(--space-2); }
@media (max-width: 700px) { .interpreter-footer-row { grid-template-columns: 1fr; } }

/* Editor with line numbers */
.code-editor-wrapper {
  display: grid;
  grid-template-columns: auto 1fr;
  align-items: stretch;
}
.code-gutter {
  user-select: none;
  color: var(--color-muted);
  background: transparent;
  width: 4ch; /* enough for 3-4 digit line numbers */
  height: 220px; /* match editor height for scroll sync */
  padding: 6px var(--space-2); /* match editor vertical padding */
  text-align: right;
  overflow: hidden; /* scroll synced from editor without showing a scrollbar */
  scroll-behavior: auto;
}
.code-gutter-pre { margin: 0; white-space: pre; line-height: 1.5; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-size: .95rem; }

.code-editor {
  width: 100%;
  height: 220px;
  resize: none; /* interpreter shouldn't be resizable */
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  font-size: .95rem;
  line-height: 1.5;
  border-radius: 0; /* remove rounded corners to make editor unobtrusive */
  border: none; /* make seamless */
  outline: none;
  background: transparent;
  /* Hide native textarea text to avoid double-render (overlay shows highlighted text) */
  color: transparent;
  caret-color: transparent; /* hide native caret; we'll draw a custom one */
  tab-size: 4;
  scroll-behavior: auto;
  position: relative;
  z-index: 2;
}

.console {
  border: var(--border-thickness) solid var(--color-border);
  border-radius: var(--radius-sm);
  background: var(--color-bg);
}
.console-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: var(--space-1) var(--space-2);
  border-bottom: none;
  flex-wrap: nowrap; /* prevent line break */
  white-space: nowrap; /* ensure single line header */
}
.console-body {
  padding: var(--space-1) var(--space-2);
  height: 80px; /* fixed size: half of previous */
  overflow: auto; /* scrollable content */
}
.console-pre {
  white-space: pre-wrap; /* support new lines */
  margin: 0;
}

:root {
  --py-kw: #a855f7; /* violet-500 */
  --py-str: #16a34a; /* green-600 */
  --py-comm: #6b7280; /* gray-500 */
  --py-num: #f59e0b; /* amber-500 */
  --py-builtin: #0ea5e9; /* sky-500 */
}

@media (prefers-color-scheme: dark) {
  :root {
    --py-kw: #c084fc; /* violet-400 */
    --py-str: #4ade80; /* green-400 */
    --py-comm: #9ca3af; /* gray-400 */
    --py-num: #fbbf24; /* amber-400 */
    --py-builtin: #38bdf8; /* sky-400 */
  }
}

/* Code editor overlay for syntax highlighting */
.code-editor-cell { position: relative; height: 220px; overflow: hidden; contain: paint; }
.code-highlight {
  position: absolute;
  inset: 0;
  padding: 6px 8px; /* match .input padding */
  pointer-events: none;
  overflow: hidden; /* hide overlay scrollbars; we scroll via translate */
  tab-size: 4;
  z-index: 1;
  will-change: transform;
  contain: paint;
}
.code-highlight-pre {
  margin: 0;
  white-space: pre; /* keep exact spacing; editor uses pre-like layout */
  line-height: 1.5;
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  font-size: .95rem;
  will-change: transform;
  backface-visibility: hidden;
  transition: none;
}

/* Token colors */
.tok-kw { color: var(--py-kw); }
.tok-str { color: var(--py-str); }
.tok-comm { color: var(--py-comm); font-style: italic; }
.tok-num { color: var(--py-num); }
.tok-builtin { color: var(--py-builtin); }

/* Editor focus outline off specifically for code editor */
.code-editor:focus-visible { outline: none; }


/* Editor selection styling for code editor */
.code-editor::selection { background: var(--editor-selection-bg); color: var(--editor-selection-text); }
.code-editor::-moz-selection { background: var(--editor-selection-bg); color: var(--editor-selection-text); }

/* Custom caret overlay */
.code-caret {
  position: absolute;
  width: 2px;
  background: var(--color-text);
  border-radius: 1px;
  pointer-events: none;
  opacity: 1;
  /* No blink; caret always visible. Transition is controlled inline and uses ease-out when enabled */
  transition: none;
  z-index: 3;
  transform-origin: top left;
  animation: caretPulse 1s ease-out infinite;
  will-change: top, left, height;
}
@keyframes caretBlink {
  0%, 49% { opacity: 1; }
  50%, 100% { opacity: 0; }
}
@keyframes caretPulse {
  0%, 100% { transform: scaleY(1) translateY(0%); }
  50% { transform: scaleY(0.75) translateY(15%); }
}
@media (prefers-reduced-motion: reduce) {
  .code-caret { transition: none; animation: none; }
}

/* Sleek global scrollbars */
:root {
  --scrollbar-size: 8px;
  --scrollbar-thumb: rgba(100, 116, 139, 0.6); /* slate-500 */
  --scrollbar-thumb-hover: rgba(100, 116, 139, 0.9);
  --scrollbar-track: transparent;
}
@media (prefers-color-scheme: dark) {
  :root {
    --scrollbar-thumb: rgba(148, 163, 184, 0.5); /* slate-400 */
    --scrollbar-thumb-hover: rgba(148, 163, 184, 0.8);
    --scrollbar-track: transparent;
  }
}
/* Firefox */
html { scrollbar-color: var(--scrollbar-thumb) var(--scrollbar-track); scrollbar-width: thin; }
/* WebKit/Blink */
*::-webkit-scrollbar { width: var(--scrollbar-size); height: var(--scrollbar-size); }
*::-webkit-scrollbar-thumb {
  background-color: var(--scrollbar-thumb);
  border-radius: 999px;
  border: var(--border-thickness) solid transparent; /* creates a pill look */
  background-clip: content-box;
}
*::-webkit-scrollbar-thumb:hover { background-color: var(--scrollbar-thumb-hover); }
*::-webkit-scrollbar-track { background: var(--scrollbar-track); }


/* MCQ choice buttons */
.choice-list { display: grid; gap: var(--space-2); }
.choice-button { display: block; width: 100%; text-align: left; }
.choice-button.is-correct { border-color: var(--color-success); }
.choice-button.is-incorrect { border-color: var(--color-danger); }


/* Fade-in animation for lesson elements */
@keyframes fade-in {
  from { opacity: 0; transform: translateY(6px); }
  to { opacity: 1; transform: translateY(0); }
}
.fade-in { animation: fade-in 220ms ease-out both; }
